# **Teia Decentralized Trust Network: Master Implementation Plan**

**Teia Trust Network** is a proposed decentralized reputation system for the Tezos art ecosystem. Moving away from binary, centralized moderation, this system calculates a probabilistic "Trust Score" for every account based on on-chain history (provenance) and social proximity.  
The architecture is designed in **Phases**, moving from a read-only indexer (MVP) to a complex graph analysis engine, and finally to a federated broadcasting system that exports Teia's trust graph to Bluesky and Nostr.

---

**Core Architecture**

The system functions as a **Subjective Oracle**. It does not enforce or censor permissions on the blockchain; instead, it provides users a nuanced view of existing marketplace data and new contract data.

* **Input:** Raw Tezos Blockchain Data (Mints, Collects, Swaps).  
* **Processing:** Graph Analysis (EigenTrust++, SybilRank, Wash Trading Detection).  
* **Output:** Trust Signals (Traffic Light UI) and Federation Labels (AT Proto/Nostr).

---

## Phase 1: The Foundation (Data Ingestion)

**Goal:** Build a robust, queryable database of all relevant relationships on Tezos. No complex math yet, just clean data.

### Infrastructure: The Indexer

We will use **DipDup** (Python) to selectively index specific smart contracts. Unlike a generic block explorer, this indexer focuses solely on the social graph.

* **Target Contracts:**  
  * hic\_et\_nunc\_v1 & v2 (Historical Data)  
  * teia\_marketplace (Current Data)  
  * objkt\_marketplace ? (Secondary Sales)  
  * registry (Tezos Profiles / Domains)

### Data Models (PostgreSQL)

The indexer will populate a relational DB with the following schema:

* **Profiles**: address (PK), alias, twitter\_handle, domain\_name, first\_seen\_at.  
* **Edges**: source\_address, target\_address, type (COLLECTED | MINTED\_COLLAB), weight (tz\_volume), timestamp.  
* **Banlists**: address, reason, source (e.g., "Teia Core Team").

### Implementation Task

Create a DipDup project with handlers for collect operations.

Python

\# handlers/on\_collect.py  
async def on\_collect(  
    ctx: HandlerContext,  
    collect: Transaction,  
) \-\> None:  
    \# 1\. Get Buyer and Creator  
    buyer \= collect.data.sender\_address  
    creator \= await get\_creator\_of\_token(collect.parameter.token\_id)  
      
    \# 2\. Update Graph Edge  
    await models.Edge.update\_or\_create(  
        source=buyer,  
        target=creator,  
        defaults={'type': 'COLLECTED', 'last\_interaction': ctx.block\_time}  
    )

## Phase 2: Badge UI MVP

**Goal:** Display simple, understandable signals in the Teia UI based on direct connections and static lists.

### The Signal Logic (Heuristics)

Before implementing complex algorithms, we use simple **Depth-1** and **Depth-2** lookups.

* **ðŸŸ¢ Trusted (Green):**  
  * **Rule:** User has collected from Artist (Depth 1\) OR User follows a curator who collected from Artist (Depth 2).  
* **ðŸ”´ Blocked (Red):**  
  * **Rule:** Artist address exists in Banlists table.  
* **ðŸŸ¡ Unknown (Yellow):**  
  * **Rule:** No connection found.  
  * **Context:** Show "Account Age" and "Total Volume" to help users judge manually.

### **4.2. API Layer**

Deploy a lightweight **FastAPI** service that exposes endpoints for the frontend.

* GET /trust/{observer\_address}/{target\_address} \-\> Returns { status: "green", reason: "You collected item \#123" }

### **UI Integration (React)**

A visual component placed on Artist Profiles and Object pages.

JavaScript

// TrustBadge.jsx  
const TrustBadge \= ({ user, artist }) \=\> {  
  const { data } \= useTrustScore(user, artist); // Calls API  
    
  if (data.status \=== 'RED') return \<BlockedBlur /\>;  
  if (data.status \=== 'GREEN') return \<Icon name="verified\_user" color="green" /\>;  
  return \<WarningBanner age={artist.accountAge} /\>;  
}

## Phase 3: Trust Engine (Algorithmic Oracle)

**Goal:** Automate trust discovery and Sybil resistance using graph theory. This moves beyond "who I know" to "who the network knows."

### "EigenTrust++"

We implement a compute worker that runs periodically (e.g., every 6 hours) to calculate Global Trust Scores.

* **Inputs:** The Edges table from Phase 1\.  
* **Logic:**  
  1. Normalize the matrix of transaction volumes (if Alice spent 100tz total, and 10tz on Bob, Bob gets 0.1 weight).  
  2. Iterate matrix multiplication until scores converge.  
  3. **Peer Credibility:** Downweight users who collect from known bad actors.

### Forensic Module: Wash Trading Detection

We use **NetworkX** to detect circular transaction patterns (e.g., A \-\> B \-\> A) that inflate volume.

* **Logic:**  
  * Find all cycles of length \< 4 in the transaction graph.  
  * If NetFlow(Cycle) â‰ˆ 0 (money returns to origin minus gas), flag as **Wash Trade**.  
  * **Action:** Reduce the Edge weight to 0 in the EigenTrust calculation.

### Identity Anchors

Integrate external verification to boost scores.

* **Tezos Domains:** Query API for .tez ownership. (+Score)  
* **Tezos Profiles (TZP):** Verify Twitter/Discord links. (+Score)


## Bonus: Federation (Add-On / Final Step)

**Goal:** Export Teia's high-quality artist data to the broader social web (Bluesky & Nostr). **This is decoupled from the main marketplace functionality.**

### Bluesky Integration (Ozone)

* **Role:** Run a **Labeler Service** (did:plc:teia-trust).  
* **Action:** When the Trust Engine (Phase 3\) identifies a high-reputation artist or a scammer:  
  1. Resolve their Tezos address to a Bluesky DID (if linked in TZP).  
  2. Emit an AT Protocol label:  
     * val: "teia-verified" (Green)  
     * val: "art-thief" (Red)  
* **User Benefit:** Bluesky users can subscribe to the "Teia Trust" labeler to see these badges inside the Bluesky app.

### Nostr Integration (Web of Trust)

* **Role:** A bot controlled by the Teia DAO keys.  
* **Action:** Publish **NIP-51 Lists**.  
  * **Kind 30000 (Follow Set):** "Teia Verified Artists" (A curated list of top EigenTrust scores).  
  * **Kind 10000 (Mute List):** "Teia Scammers" (Addresses flagged by the Banlist).  
* **User Benefit:** Nostr clients (like Primal) can subscribe to these lists to auto-filter their feeds.

---

**Implementation Roadmap**

| Milestone | Component | Description | Technologies |
| :---- | :---- | :---- | :---- |
| **M1** | **Indexer** | Setup DipDup, sync history, store in Postgres. | Python, SQL, Docker |
| **M2** | **Basic API** | Endpoints for "Depth-1" checks and banlist lookup. | FastAPI |
| **M3** | **UI Badge** | React component on Teia.art showing Green/Yellow/Red. | React, JS |
| **M4** | **Trust Worker** | Script running EigenTrust++ & Cycle Detection. | NetworkX, NumPy |
| **M5** | **Identity** | Integration of TZP and Tezos Domains into score. | GraphQL |
| **M6** | **Federation** | Bluesky Labeler & Nostr List Bot (Optional). | TypeScript, Ozone |