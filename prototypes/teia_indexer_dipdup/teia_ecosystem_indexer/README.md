<!-- # generated by DipDup 8.5.1 -->
# teia_ecosystem_indexer

Teia and h=n token and transaction indexer built on dipdup

## Installation

This project is based on [DipDup](https://dipdup.io), a framework for building featureful dapps.

You need a Linux/macOS system with Python 3 installed. To install DipDup use `uv tool install` command or our installer script:

```shell
curl -Lsf https://dipdup.io/install.py | python3
```

See the [Installation](https://dipdup.io/docs/installation) page for all options.

## Usage

Run the indexer in memory:

```shell
dipdup run
```

Store data in SQLite database (defaults to /tmp, set `SQLITE_PATH` env variable):

```shell
dipdup -C sqlite run
```

Or spawn a Compose stack with PostgreSQL and Hasura:

```shell
# Create default env file
dipdup -C compose config env -o deploy/.env

# Edit `deploy/.env` before running
make up
```

## Development setup

To set up the development environment run:

```shell
make install
source .venv/bin/activate
```

Don't forget to initialize project after significant changes and keep DipDup up to date:

```shell
dipdup init
make update
```

Run `make all` to run full CI check or `make help` to see other available commands.

---

## Operator runbook (short) ðŸ”§

When you're running or triaging the indexer, use these quick steps:

- Start (dev): `dipdup run` or `uv run teia_indexer.py`
- Start (sqlite): `dipdup -C sqlite run` (set `SQLITE_PATH`)
- Restart after code changes: stop process, `dipdup init` (if schema changed), then `dipdup run`

### Quick health checks
- Index sync progress is visible in logs (look for `synchronizing` â†’ `synced`).
- Confirm handler activity via logs (`SAVED SWAP`, `EDGE CREATED`, etc.).
- Run project helper: `uv run check_indexer_progress.py` (returns 0 on basic health).

### Known gotchas (and how we fixed them)
- Big-map diffs sometimes arrive as plain `dict` (RPC) instead of DipDup model objects â€” handlers now accept both shapes.
- Some entrypoint parameter types are wrapped/pydantic objects; normalize before passing to ORM (we added `swap_id` normalization).

### Useful commands
- Show recent swaps (sqlite):
  - `sqlite3 teia_trust.sqlite3 "SELECT * FROM swap ORDER BY timestamp DESC LIMIT 10;"`
- Show DipDup reports for recent crashes:
  - `dipdup report show <report_id>`

---

If you'd like, I can:
- add handler-level unit tests that assert both `dict` and `object` parameter/diff shapes are handled; or
- centralize the normalization helpers and open a PR with tests.